// Zellij config - tabs only, no panes

// Default shell
default_shell "zsh"

// General settings
mouse_mode true
copy_on_select true
scrollback_editor "nvim"
default_mode "normal"
pane_frames false
session_serialization true     // Enable session persistence (like tmux-resurrect)
serialization_interval 60      // Autosave every 60 seconds (like tmux-continuum)

// Use the custom layout with tabs at bottom, no status bar
default_layout "default"

// Disable the default status bar tips
simplified_ui true

// Theme - matching your tmux status bar colors
theme "custom"
themes {
    custom {
        fg "#abb2bf"
        bg "#333333"
        black "#333333"
        red "#e06c75"
        green "#98c379"
        yellow "#e5c07b"
        blue "#5eacd3"
        magenta "#5eacd3"
        cyan "#5eacd3"
        white "#abb2bf"
        orange "#d19a66"
    }
}

// UI settings
ui {
    pane_frames {
        hide_session_name true
    }
}

// Keybindings - clear all defaults and only bind what we need
keybinds clear-defaults=true {
    // Normal mode - main working mode
    normal {
        // Ctrl+. as prefix to enter "tmux" mode
        bind "Ctrl ." { SwitchToMode "tmux"; }

        // Ctrl+q to detach (exit but keep session running)
        bind "Ctrl q" { Detach; }

        // Alt+number for tab switching
        bind "Alt 1" { GoToTab 1; }
        bind "Alt 2" { GoToTab 2; }
        bind "Alt 3" { GoToTab 3; }
        bind "Alt 4" { GoToTab 4; }
        bind "Alt 5" { GoToTab 5; }
        bind "Alt 6" { GoToTab 6; }
        bind "Alt 7" { GoToTab 7; }
        bind "Alt 8" { GoToTab 8; }
        bind "Alt 9" { GoToTab 9; }

        // Ctrl+f for sessionizer (fzf project picker)
        bind "Ctrl f" {
            Run "zellij-sessionizer" {
                floating true
                close_on_exit true
                x "20%"
                y "10%"
                width "60%"
                height "80%"
            }
        }
    }

    // "Tmux" mode - activated with Ctrl+. prefix
    tmux {
        bind "Ctrl ." { SwitchToMode "normal"; }
        bind "Esc" { SwitchToMode "normal"; }

        // Tab management
        bind "n" { NewTab; SwitchToMode "normal"; }
        bind "x" { CloseTab; SwitchToMode "normal"; }
        bind "p" { GoToPreviousTab; SwitchToMode "normal"; }
        bind "Tab" { GoToNextTab; SwitchToMode "normal"; }
        bind "," { SwitchToMode "RenameTab"; TabNameInput 0; }

        // Session management
        bind "q" { Detach; }                    // Detach (keeps session running)
        bind "Q" { Quit; }                      // Force quit (destroys session)
        bind "s" {
            LaunchOrFocusPlugin "session-manager" {
                floating true
                move_to_focused_tab true
            }
            SwitchToMode "normal"
        }

        // Scroll/copy mode
        bind "[" { SwitchToMode "scroll"; }
        bind "v" { SwitchToMode "scroll"; }
    }

    // Scroll/copy mode - vi keys
    scroll {
        bind "Esc" { SwitchToMode "normal"; }
        bind "q" { SwitchToMode "normal"; }
        bind "Ctrl c" { SwitchToMode "normal"; }
        bind "Ctrl ." { SwitchToMode "normal"; }

        // Vi navigation
        bind "j" { ScrollDown; }
        bind "k" { ScrollUp; }
        bind "d" { HalfPageScrollDown; }
        bind "u" { HalfPageScrollUp; }
        bind "f" { PageScrollDown; }
        bind "b" { PageScrollUp; }
        bind "g" { ScrollToTop; }
        bind "G" { ScrollToBottom; }

        // Search
        bind "/" { SwitchToMode "entersearch"; SearchInput 0; }
        bind "n" { Search "Down"; }
        bind "N" { Search "Up"; }

        // Enter select mode for copying
        bind "v" { SwitchToMode "search"; }
        bind "Space" { SwitchToMode "search"; }
    }

    search {
        bind "Esc" { SwitchToMode "normal"; }
        bind "q" { SwitchToMode "normal"; }
        bind "Ctrl c" { SwitchToMode "normal"; }
        bind "Ctrl ." { SwitchToMode "normal"; }

        // Vi navigation in search/select mode
        bind "j" { ScrollDown; }
        bind "k" { ScrollUp; }
        bind "d" { HalfPageScrollDown; }
        bind "u" { HalfPageScrollUp; }

        // Search
        bind "/" { SwitchToMode "entersearch"; SearchInput 0; }
        bind "n" { Search "Down"; }
        bind "N" { Search "Up"; }

        // Toggle search options
        bind "c" { SearchToggleOption "CaseSensitivity"; }
        bind "w" { SearchToggleOption "Wrap"; }
        bind "o" { SearchToggleOption "WholeWord"; }

        // Copy
        bind "y" { Copy; SwitchToMode "normal"; }
    }

    entersearch {
        bind "Esc" { SwitchToMode "scroll"; }
        bind "Ctrl ." { SwitchToMode "normal"; }
        bind "Enter" { SwitchToMode "search"; }
    }

    // Rename tab mode
    RenameTab {
        bind "Esc" { UndoRenameTab; SwitchToMode "normal"; }
        bind "Ctrl ." { SwitchToMode "normal"; }
        bind "Enter" { SwitchToMode "normal"; }
    }
}

// Plugins
plugins {
    session-manager location="zellij:session-manager"
}
